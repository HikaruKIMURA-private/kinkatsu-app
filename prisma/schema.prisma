generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "darwin-arm64"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Exercise {
  id           String        @id @default(cuid())
  name         String        @unique
  createdBy    String?
  createdAt    DateTime      @default(now())
  bodyParts    BodyPart[]
  workoutItems WorkoutItem[]

  @@index([name])
}

model Workout {
  id         String        @id @default(cuid())
  userId     String
  date       DateTime
  bodyWeight Decimal?      @db.Decimal(5, 2)
  dayRpe     Decimal?      @db.Decimal(3, 1)
  notes      String?
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  user       User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  items      WorkoutItem[]

  @@unique([userId, date])
  @@index([userId, date])
}

model WorkoutItem {
  id         String       @id @default(cuid())
  workoutId  String
  exerciseId String
  orderIndex Int
  createdAt  DateTime     @default(now())
  exercise   Exercise     @relation(fields: [exerciseId], references: [id])
  workout    Workout      @relation(fields: [workoutId], references: [id], onDelete: Cascade)
  sets       WorkoutSet[]

  @@index([workoutId, orderIndex])
}

model WorkoutSet {
  id            String      @id @default(cuid())
  workoutItemId String
  weightKg      Decimal     @db.Decimal(6, 2)
  reps          Int
  rpe           Decimal?    @db.Decimal(3, 1)
  createdAt     DateTime    @default(now())
  workoutItem   WorkoutItem @relation(fields: [workoutItemId], references: [id], onDelete: Cascade)

  @@index([workoutItemId])
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified Boolean   @default(false)
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  workouts      Workout[]
  accounts      Account[]
  passkeys      Passkey[]
  sessions      Session[]

  @@map("user")
}

model Session {
  id        String   @id @default(cuid())
  expiresAt DateTime
  token     String   @unique
  ipAddress String?
  userAgent String?
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@map("session")
}

model Account {
  id           String    @id @default(cuid())
  accountId    String
  providerId   String
  userId       String
  accessToken  String?
  refreshToken String?
  idToken      String?
  expiresAt    DateTime?
  password     String?
  scope        String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([providerId, accountId])
  @@index([userId])
  @@map("account")
}

model Verification {
  id         String   @id @default(cuid())
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([identifier, value])
  @@map("verification")
}

model Passkey {
  id           String   @id @default(cuid())
  name         String?
  publicKey    String
  userId       String
  credentialID String   @unique @map("credentialId")
  counter      BigInt   @default(0)
  deviceType   String
  backedUp     Boolean  @default(false)
  transports   String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([credentialID])
  @@map("passkey")
}

enum BodyPart {
  CHEST
  BACK
  LEGS
  ABS
  ARMS
  SHOULDERS
  FOREARMS
  CALVES
  OTHER
}
